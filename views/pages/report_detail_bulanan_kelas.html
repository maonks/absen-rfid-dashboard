<style>
/* === PRINT & MOBILE STYLE (SAMA PERSIS) === */
.screen-only { display: block; }
.print-only  { display: none; }

@media print {
  body * { visibility: hidden; }

  #print-area, 
  #print-area * { 
    visibility: visible; 
  }

  #print-area {
    position: absolute;
    left: 0;
    top: 0;
    width: 100%;
  }

  .print-only  { display: block; }
  .screen-only { display: none; }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 11px;
  }

  th, td {
    border: 1px solid black;
    padding: 4px;
  }

  h2 {
    text-align: center;
    margin-bottom: 8px;
  }

  @page {
    size: A4 landscape;
    margin: 10mm;
  }
}
</style>

<h2 class="text-lg font-bold mb-3 screen-only">
  Rekap Detail Absensi
</h2>

<!-- FILTER -->
<form method="GET"
      action="/report/bulanan/kelas-detail"
      class="screen-only w-full mb-3 text-[11px]">

  <div class="flex flex-col sm:flex-row gap-2">

    <!-- BARIS FILTER -->
    <div class="flex justify-center gap-2">

      <select name="kelas_id" class="border rounded px-2 py-1">
        <option value="">Kelas</option>
        {{ range .Kelas }}
          <option value="{{ .ID }}" {{ if eq $.KelasID .ID }}selected{{ end }}>
            {{ .Nama }}
          </option>
        {{ end }}
      </select>

      <select name="jurusan_id" class="border rounded px-2 py-1">
        <option value="">Jurusan</option>
        {{ range .Jurusan }}
          <option value="{{ .ID }}" {{ if eq $.JurusanID .ID }}selected{{ end }}>
            {{ .Nama }}
          </option>
        {{ end }}
      </select>


      <select name="bulan" class="border rounded px-2 py-1">
        <option value="">Bulan</option>
        {{ range .BulanList }}
          <option value="{{ .Value }}" {{ if eq $.Bulan .Value }}selected{{ end }}>
            {{ .Label }}
          </option>
        {{ end }}
      </select>

      <select name="tahun" class="border rounded px-2 py-1">
        {{ range .TahunList }}
          <option value="{{ . }}" {{ if eq $.Tahun . }}selected{{ end }}>
            {{ . }}
          </option>
        {{ end }}
      </select>

    </div>

    <!-- BARIS BUTTON -->
    <div class="flex justify-center gap-2">
      <button type="submit"
              class="px-3 py-1 bg-slate-700 text-white rounded">
        üîç Generate
      </button>

      <button type="button"
              onclick="window.print()"
              class="px-3 py-1 bg-blue-600 text-white rounded">
        üñ®Ô∏è Print
      </button>

      {{ if .Rows }}
      <button type="button"
        onclick="window.location.href='/report/bulanan/kelas-detail/excel?kelas_id={{.KelasID}}&jurusan_id={{.JurusanID}}&bulan={{.Bulan}}&tahun={{.Tahun}}'"
        class="px-3 py-1 rounded bg-green-600 text-white hover:bg-green-700">
        üìä Excel
      </button>
      {{ end }}
    </div>

  </div>
</form>

<!-- PRINT AREA -->
<div id="print-area">
  <h2 class="text-lg font-bold mb-3 text-center print-only">
      Report Detail Bulanan
      {{ if .KelasID }}Kelas {{ .KelasName }}{{ end }}
      {{ if .JurusanID }} - {{ .JurusanName }}{{ end }}
      <br>
      Periode: {{ .BulanLabel }} {{ .Tahun }}
  </h2>

  <table class="min-w-full text-[11px] border-collapse">

    <thead class="bg-slate-100 sticky-header">
      <tr>
        <th class="border px-2">No</th>
        <th class="border px-2">Nama</th>
        {{ range .Days }}
          <th class="border px-2">{{ . }}</th>
        {{ end }}
      </tr>
    </thead>

    <tbody>
      {{ range $i, $row := .Rows }}
      <tr>
        <td class="border px-2 text-center">
          {{ add $i 1 }}
        </td>

        <td class="border px-2 sticky-name">
          {{ $row.Nama }}
        </td>

        {{ range $.Days }}
          {{ $cell := index $row.Hari . }}
          <td class="border px-1 text-center">

            {{ if not $cell }}
              -
            {{ else if eq $cell.Status "OK" }}
              {{ $cell.Masuk }}
            {{ else if eq $cell.Status "LATE" }}
              {{ $cell.Masuk }}
            {{ else if eq $cell.Status "IJIN" }}
              IJIN
            {{ else if eq $cell.Status "SAKIT" }}
              SAKIT
            {{ else if eq $cell.Status "ALPA" }}
              ALPA
            {{ else if eq $cell.Status "LIBUR" }}
              LIBUR
            {{ end }}

          </td>
        {{ end }}

      </tr>
      {{ end }}
    </tbody>

  </table>

</div>
