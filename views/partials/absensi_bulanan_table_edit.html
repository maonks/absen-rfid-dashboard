<!-- ================= EDIT MODE : ABSENSI BULANAN ================= -->

<div class="mb-3 flex justify-between items-center">
 <div>   
  <span class="text-xs text-slate-600 italic">
    ✏️ Mode Edit Aktif — perubahan disimpan otomatis
  </span>

  <button
    hx-get="/absensi/bulanan/table?bulan={{ .SelectedMonth }}&tahun={{ .SelectedYear }}"
    hx-target="#absensi-bulanan"
    hx-swap="innerHTML"
    class="px-3 py-1 rounded bg-red-700 text-white text-xs hover:bg-red-800"
  >
    ✔️ Selesai Edit
  </button>
  </div>
</div>

<div class="overflow-x-auto border rounded-lg shadow-sm">
  <table class="min-w-full text-[11px] border-collapse">

    <!-- HEADER -->
    <thead class="sticky-header bg-slate-100">
      <tr>
        <th class="px-2 py-2 border text-center w-10">No</th>
        <th class="px-3 py-2 border text-left w-48 sticky-name">Nama</th>

        {{ range .Days }}
          <th class="px-2 py-2 border text-center">
            {{ . }}
          </th>
        {{ end }}
      </tr>
    </thead>

    <!-- BODY -->
    <tbody>
    {{ range $i, $row := .Rows }}
      <tr class="hover:bg-slate-50 transition">

        <!-- NO -->
        <td class="px-2 py-1 text-center border">
          {{ add $i 1 }}
        </td>

        <!-- NAMA -->
        <td class="px-3 py-1 border sticky-name font-semibold">
          {{ $row.Nama }}
        </td>

        <!-- DAY CELLS -->
        {{ range $.Days }}
          {{ $cell := index $row.Hari . }}

          <td class="px-1 py-1 border text-center align-middle">

            <select
              name="status"
              class="
                cell
                w-full
                text-slate-500
                text-center
                border border-slate-300
                rounded
            
                focus:outline-none
                hover:border-slate-400
                appearance-none

                pr-2
                cell cell-select 
                
                {{ if eq $cell.Status "OK" }}bg-green-200{{ end }}
                {{ if eq $cell.Status "LATE" }}bg-red-200{{ end }}
                {{ if eq $cell.Status "IJIN" }}bg-blue-200{{ end }}
                {{ if eq $cell.Status "SAKIT" }}bg-yellow-200{{ end }}
                {{ if eq $cell.Status "ALPA" }}bg-slate-200{{ end }}"

              hx-post="/absensi/bulanan/update"
              hx-trigger="change"
              hx-vals='{
                "user_id": "{{ $row.ID }}",
                "tanggal": "{{ . }}"
              }'
            >
              <option value="PENDING" 
                {{ if or (eq $cell.Status "") (eq $cell.Status "PENDING") }}selected{{ end }}disabled>-</option>

              <option value="OK"    {{ if and $cell (eq $cell.Status "OK") }}selected{{ end }}>HADIR</option>
              <option value="LATE"  {{ if and $cell (eq $cell.Status "LATE") }}selected{{ end }}>TERLAMBAT</option>
              <option value="IJIN"  {{ if and $cell (eq $cell.Status "IJIN") }}selected{{ end }}>IJIN</option>
              <option value="SAKIT" {{ if and $cell (eq $cell.Status "SAKIT") }}selected{{ end }}>SAKIT</option>
              <option value="ALPA"  {{ if and $cell (eq $cell.Status "ALPA") }}selected{{ end }}>ALPA</option>              
                <option value="LIBUR" {{ if and $cell (eq $cell.Status "LIBUR") }}selected{{ end }}>LIBUR</option>
            </select>

            

          </td>
        {{ end }}

      </tr>
    {{ end }}
    </tbody>

  </table>
</div>
